<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Register — Flag Frenzy Football Camp</title>
    <meta
      name="description"
      content="Register for Flag Frenzy Football Camp. Safe, non-contact American flag football for ages 7–15."
    />
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&display=swap"
      rel="stylesheet"
    />
    <!-- CAMP THEME -->
    <link rel="stylesheet" href="/camp/css/style.css" />
  </head>

  <body>
    <!-- Header -->
    <header class="bg-white shadow-md">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="h-16 flex items-center justify-between">
          <a href="/camp/index.html" class="flex items-center gap-3">
            <img
              src="/camp/src/logo.png"
              alt="Flag Frenzy Football Camp logo"
              class="h-10 w-10"
            />
            <span class="text-xl font-extrabold" style="color: var(--camp-red)"
              >Flag Frenzy Football Camp</span
            >
          </a>

          <button
            id="menuBtn"
            class="md:hidden p-2 rounded-lg border border-gray-200"
            aria-label="Toggle menu"
          >
            ☰
          </button>

          <nav
            id="nav"
            class="hidden md:flex items-center gap-6 text-sm font-medium"
          >
            <a class="hover:text-[var(--camp-red)]" href="/camp/index.html"
              >Home</a
            >
            <a class="hover:text-[var(--camp-red)]" href="/camp/about.html"
              >About</a
            >
            <a class="hover:text-[var(--camp-red)]" href="/camp/register.html"
              >Register</a
            >
            <a class="hover:text-[var(--camp-red)]" href="/camp/policies.html"
              >Policies</a
            >
            <a class="hover:text-[var(--camp-red)]" href="/camp/faqs.html"
              >FAQs</a
            >
            <a class="hover:text-[var(--camp-red)]" href="/camp/contact.html"
              >Contact</a
            >
            <a class="btn btn-outline" href="/index.html">Main Site</a>
          </nav>
        </div>

        <!-- Mobile Nav -->
        <nav
          id="mobileNav"
          class="hidden md:hidden border-t border-[var(--camp-border)] py-3"
        >
          <div class="flex flex-col gap-3 font-medium">
            <a class="hover:text-[var(--camp-red)]" href="/camp/index.html"
              >Home</a
            >
            <a class="hover:text-[var(--camp-red)]" href="/camp/about.html"
              >About</a
            >
            <a class="hover:text-[var(--camp-red)]" href="/camp/register.html"
              >Register</a
            >
            <a class="hover:text-[var(--camp-red)]" href="/camp/policies.html"
              >Policies</a
            >
            <a class="hover:text-[var(--camp-red)]" href="/camp/faqs.html"
              >FAQs</a
            >
            <a class="hover:text-[var(--camp-red)]" href="/camp/contact.html"
              >Contact</a
            >
            <a class="btn btn-outline w-max" href="/index.html">Main Site</a>
          </div>
        </nav>
      </div>
    </header>

    <!-- Intro -->
    <section class="hero-bg">
      <div
        class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 pt-12 pb-8 text-center"
      >
        <h1
          class="text-3xl font-extrabold"
          style="color: var(--camp-primary-900)"
        >
          Registration Form
        </h1>
        <p class="mt-2 text-base text-gray-800">
          Complete the form below and we’ll email you as soon as booking opens.
        </p>
      </div>
    </section>

    <!-- Form -->
    <section class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 pb-16">
      <!-- Temporary Notice Banner -->
      <div
        class="bg-[var(--camp-cream)] border-l-4 border-[var(--camp-red)] text-[var(--camp-green)] p-4 mb-6 rounded shadow"
      >
        <p class="font-bold text-[var(--camp-red)]">
          ⚠️ Registration Coming Soon
        </p>
        <p>
          Our full registration form isn’t live yet. Please use our
          <a
            href="/camp/interest.html"
            class="underline font-semibold text-[var(--camp-red)] hover:text-[var(--camp-green)]"
          >
            Register Your Interest form
          </a>
          so we can keep you updated.
        </p>
      </div>
      <section class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 pb-14">
        <form
          id="registerForm"
          name="camper-registration"
          method="POST"
          data-netlify="true"
          netlify
          netlify-honeypot="bot-field"
          action="/camp/thank-you.html"
          class="form form-card mt-6 grid gap-5"
        >
          <input type="hidden" name="form-name" value="camper-registration" />
          <input type="text" name="bot-field" class="hidden" />
          <p class="hidden">
            <label
              >Don’t fill this out if you're human: <input name="bot-field"
            /></label>
          </p>

          <!-- Camper info -->
          <div>
            <h2 class="section-title text-xl">Camper information</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-5 mt-4">
              <div>
                <label class="label" for="camper-name">Full name</label>
                <input
                  class="input"
                  type="text"
                  id="camper-name"
                  name="camper-name"
                  required
                />
              </div>
              <div>
                <label class="label" for="camper-age">Age</label>
                <input
                  class="input"
                  type="number"
                  id="camper-age"
                  name="camper-age"
                  min="7"
                  max="15"
                  required
                />
              </div>
            </div>

            <div class="mt-4">
              <label class="label">Date of birth</label>
              <div class="grid grid-cols-3 gap-3">
                <select class="input" id="dob-day" name="dob-day" required>
                  <option value="">Day</option>
                </select>
                <select class="input" id="dob-month" name="dob-month" required>
                  <option value="">Month</option>
                </select>
                <select class="input" id="dob-year" name="dob-year" required>
                  <option value="">Year</option>
                </select>
              </div>
            </div>
          </div>

          <!-- Attendance -->
          <div>
            <h2 class="section-title text-xl">Attendance</h2>
            <div class="mt-4">
              <label class="label" for="week">Which week?</label>
              <select class="input bg-white" id="week" name="week" required>
                <option value="">Select week</option>
                <option value="Week 1">Week 1 (27–31 Oct)</option>
              </select>
            </div>

            <div class="mt-4">
              <span class="label">Attendance option</span>
              <div class="space-y-2">
                <label class="flex items-center gap-2">
                  <input
                    type="radio"
                    name="attendance"
                    value="Full Week"
                    required
                  />
                  <span>Full week</span>
                </label>
                <label class="flex items-center gap-2">
                  <input type="radio" name="attendance" value="Choose Dates" />
                  <span>Choose specific dates</span>
                </label>
              </div>

              <div id="day-selector" class="hidden">
                <label class="label mt-4">Select dates attending</label>
                <div class="space-y-2 text-sm">
                  <label
                    ><input
                      type="checkbox"
                      name="selected-dates"
                      value="Mon 27 Oct"
                      class="mr-2"
                    />Mon 27 Oct</label
                  ><br />
                  <label
                    ><input
                      type="checkbox"
                      name="selected-dates"
                      value="Tue 28 Oct"
                      class="mr-2"
                    />Tue 28 Oct</label
                  ><br />
                  <label
                    ><input
                      type="checkbox"
                      name="selected-dates"
                      value="Wed 29 Oct"
                      class="mr-2"
                    />Wed 29 Oct</label
                  ><br />
                  <label
                    ><input
                      type="checkbox"
                      name="selected-dates"
                      value="Thu 30 Oct"
                      class="mr-2"
                    />Thu 30 Oct</label
                  ><br />
                  <label
                    ><input
                      type="checkbox"
                      name="selected-dates"
                      value="Fri 31 Oct"
                      class="mr-2"
                    />Fri 31 Oct</label
                  >
                </div>
              </div>
            </div>
          </div>

          <!-- Sibling Discount -->
          <div class="mb-6">
            <fieldset id="sibling-fieldset">
              <legend class="block text-sm font-medium text-gray-900">
                Sibling Discount
              </legend>

              <p class="mt-1 text-sm text-gray-700">
                Is this camper attending <strong>with a sibling</strong> who is
                also registered for this camp?
              </p>

              <div class="mt-3 flex gap-6">
                <label class="flex items-center gap-2 text-gray-900">
                  <input
                    type="radio"
                    name="sibling"
                    value="Yes"
                    class="h-4 w-4 text-[var(--camp-red)] focus:ring-[var(--camp-red)] border-gray-300 bg-white"
                    required
                  />
                  <span class="text-gray-900">Yes</span>
                </label>

                <label class="flex items-center gap-2 text-gray-900">
                  <input
                    type="radio"
                    name="sibling"
                    value="No"
                    class="h-4 w-4 text-[var(--camp-red)] focus:ring-[var(--camp-red)] border-gray-300 bg-white"
                    required
                  />
                  <span class="text-gray-900">No</span>
                </label>
              </div>

              <!-- Helper line -->
              <p class="mt-2 text-xs text-gray-500">
                Discount is applied at checkout — use promo code
                <strong>SIBLING10</strong> on Stripe, or select the sibling
                PayPal link.
              </p>

              <p class="text-sm text-gray-600 mt-4">
                Please submit a <strong>separate form</strong> for each child.
                The discount applies only to
                <strong>additional</strong> children.
              </p>

              <label class="flex items-center gap-2 text-sm text-gray-800 mt-3">
                <input
                  type="checkbox"
                  name="confirm-discount-policy"
                  id="confirm-discount-policy"
                  class="h-4 w-4 text-[var(--camp-red)] focus:ring-[var(--camp-red)] border-gray-300 bg-white"
                  required
                />
                I understand the sibling discount applies only to additional
                children registered separately.
              </label>
            </fieldset>
          </div>

          <!-- Parent/Guardian 1 -->
          <div>
            <h2 class="section-title text-xl">Parent/guardian (required)</h2>
            <div class="grid md:grid-cols-2 gap-5 mt-4">
              <div>
                <label class="label" for="parent-name">Full name</label>
                <input
                  class="input"
                  type="text"
                  id="parent-name"
                  name="parent-name"
                  required
                />
              </div>
              <div>
                <label class="label" for="parent-phone">Phone number</label>
                <input
                  class="input"
                  type="tel"
                  id="parent-phone"
                  name="parent-phone"
                  required
                />
              </div>
            </div>
            <div class="mt-4">
              <label class="label" for="parent-email">Email address</label>
              <input
                class="input"
                type="email"
                id="parent-email"
                name="parent-email"
                required
              />
            </div>
          </div>

          <!-- Parent/Guardian 2 (optional) -->
          <div>
            <h2 class="section-title text-xl">
              Additional parent/guardian (optional)
            </h2>
            <div class="grid md:grid-cols-2 gap-5 mt-4">
              <div>
                <label class="label" for="second-parent-name">Full name</label>
                <input
                  class="input"
                  type="text"
                  id="second-parent-name"
                  name="second-parent-name"
                />
              </div>
              <div>
                <label class="label" for="second-parent-phone"
                  >Phone number</label
                >
                <input
                  class="input"
                  type="tel"
                  id="second-parent-phone"
                  name="second-parent-phone"
                />
              </div>
            </div>
            <div class="mt-4">
              <label class="label" for="second-parent-email"
                >Email address</label
              >
              <input
                class="input"
                type="email"
                id="second-parent-email"
                name="second-parent-email"
              />
            </div>
          </div>

          <!-- Emergency contacts -->
          <div>
            <h2 class="section-title text-xl">Emergency contacts (required)</h2>

            <div class="mt-4 grid md:grid-cols-2 gap-6">
              <div class="card">
                <h3
                  class="font-bold mb-2"
                  style="color: var(--camp-primary-900)"
                >
                  Contact 1
                </h3>
                <label class="label" for="emergency1-name">Full name</label>
                <input
                  class="input"
                  type="text"
                  id="emergency1-name"
                  name="emergency1-name"
                  required
                />
                <label class="label mt-3" for="emergency1-phone"
                  >Phone number</label
                >
                <input
                  class="input"
                  type="tel"
                  id="emergency1-phone"
                  name="emergency1-phone"
                  required
                />
                <label class="label mt-3" for="emergency1-relationship"
                  >Relationship</label
                >
                <input
                  class="input"
                  type="text"
                  id="emergency1-relationship"
                  name="emergency1-relationship"
                  required
                />
              </div>

              <div class="card">
                <h3
                  class="font-bold mb-2"
                  style="color: var(--camp-primary-900)"
                >
                  Contact 2
                </h3>
                <label class="label" for="emergency2-name">Full name</label>
                <input
                  class="input"
                  type="text"
                  id="emergency2-name"
                  name="emergency2-name"
                  required
                />
                <label class="label mt-3" for="emergency2-phone"
                  >Phone number</label
                >
                <input
                  class="input"
                  type="tel"
                  id="emergency2-phone"
                  name="emergency2-phone"
                  required
                />
                <label class="label mt-3" for="emergency2-relationship"
                  >Relationship</label
                >
                <input
                  class="input"
                  type="text"
                  id="emergency2-relationship"
                  name="emergency2-relationship"
                  required
                />
              </div>
            </div>
          </div>

          <!-- Health & Medical -->
          <div>
            <h2 class="section-title text-xl">Health & medical</h2>
            <p class="section-note mt-1">Please select all that apply.</p>

            <div class="mt-3 space-y-2 text-sm text-gray-800">
              <label
                ><input
                  type="checkbox"
                  name="medical-conditions"
                  value="None"
                  class="mr-2"
                />None</label
              ><br />
              <label
                ><input
                  type="checkbox"
                  name="medical-conditions"
                  value="Asthma"
                  class="mr-2"
                />Asthma</label
              ><br />
              <label
                ><input
                  type="checkbox"
                  name="medical-conditions"
                  value="Severe Allergies"
                  class="mr-2"
                />Severe Allergies</label
              ><br />
              <label
                ><input
                  type="checkbox"
                  name="medical-conditions"
                  value="Epilepsy"
                  class="mr-2"
                />Epilepsy</label
              ><br />
              <label
                ><input
                  type="checkbox"
                  name="medical-conditions"
                  value="Diabetes"
                  class="mr-2"
                />Diabetes</label
              ><br />
              <label
                ><input
                  type="checkbox"
                  name="medical-conditions"
                  value="Other"
                  class="mr-2"
                />Other (please explain below)</label
              >
            </div>

            <label class="label mt-4" for="medical-details"
              >Additional medical details or medications</label
            >
            <textarea
              class="input h-36"
              id="medical-details"
              name="medical-details"
              placeholder="Include EpiPen needs, inhalers, recent injuries, etc."
            ></textarea>
          </div>

          <!-- Inclusion & Additional Needs -->
          <div>
            <h2 class="section-title text-xl">Inclusion & additional needs</h2>
            <p class="section-note mt-1">
              Help us support your child from day one.
            </p>

            <div class="mt-4 grid md:grid-cols-2 gap-5">
              <div>
                <label class="label" for="pronouns"
                  >Child’s pronouns (optional)</label
                >
                <input
                  class="input"
                  type="text"
                  id="pronouns"
                  name="pronouns"
                  placeholder="e.g. she/her, he/him, they/them"
                />
              </div>

              <div>
                <label class="label" for="language"
                  >Primary language / communication notes</label
                >
                <input
                  class="input"
                  type="text"
                  id="language"
                  name="language"
                  placeholder="e.g. English, uses visual prompts"
                />
              </div>
            </div>

            <div class="mt-4 grid md:grid-cols-2 gap-5">
              <div>
                <label class="label" for="send"
                  >SEND / diagnosed conditions</label
                >
                <select class="input bg-white" id="send" name="send">
                  <option value="">Please select</option>
                  <option value="none">None</option>
                  <option value="suspected">
                    Suspected / under assessment
                  </option>
                  <option value="diagnosed">Diagnosed</option>
                </select>
              </div>

              <div>
                <label class="label" for="ehcp">EHCP in place?</label>
                <select class="input bg-white" id="ehcp" name="ehcp">
                  <option value="">Please select</option>
                  <option value="no">No</option>
                  <option value="yes">Yes</option>
                </select>
              </div>
            </div>

            <div class="mt-4">
              <label class="label" for="access-needs"
                >Access needs / reasonable adjustments</label
              >
              <textarea
                class="input h-36"
                id="access-needs"
                name="access-needs"
                placeholder="Tell us about any support, strategies, triggers, mobility or sensory needs, 1:1 support, break plans, etc."
              ></textarea>
            </div>

            <div class="mt-4">
              <label class="label" for="pickup"
                >Authorised pick-up adults (names & relationship)</label
              >
              <textarea
                class="input h-28"
                id="pickup"
                name="pickup"
                placeholder="e.g. Taylor Smith (Mum), Jordan Smith (Grandad)"
              ></textarea>
              <p class="text-xs text-gray-600 mt-1">
                We may ask for ID at pick-up.
              </p>
            </div>

            <div class="mt-4">
              <label class="label" for="other-notes"
                >Anything else we should know?</label
              >
              <textarea
                class="input h-28"
                id="other-notes"
                name="other-notes"
                placeholder="Behaviour strategies that work well, allergies not requiring medication, religious/cultural considerations, etc."
              ></textarea>
            </div>
          </div>

          <!-- Consent -->
          <fieldset class="space-y-3">
            <legend class="section-title text-xl">Consent</legend>
            <label class="flex items-center gap-2"
              ><input type="checkbox" name="consent-participation" required /> I
              give permission for my child to participate.</label
            >
            <label class="flex items-center gap-2"
              ><input type="checkbox" name="consent-medical" required /> I give
              permission for first aid to be administered if necessary.</label
            >
            <label class="flex items-center gap-2"
              ><input type="checkbox" name="consent-media" /> I give permission
              for my child to be included in photos/videos.</label
            >
            <label class="flex items-center gap-2"
              ><input type="checkbox" name="consent-policy" required /> I agree
              to the privacy policy and terms.</label
            >
          </fieldset>

          <!-- Submit -->
          <div>
            <button
              type="submit"
              class="inline-block bg-[var(--camp-red)] text-white font-bold py-3 px-6 rounded-lg shadow hover:bg-red-700 transition"
            >
              Register
            </button>

            <p
              id="payment-summary"
              class="mt-4 text-lg font-semibold text-center"
              style="color: var(--camp-primary)"
            >
              Total due: £135<br />
              <small class="text-sm text-gray-600">
                Full week: £150 &nbsp;•&nbsp; Early-bird:
                <strong>£135</strong> until <strong>3 Oct</strong> &nbsp;•&nbsp;
                Day rate: £35
                <br />
                Sibling discount: <strong>£10</strong> for additional children
                only.
              </small>
            </p>
          </div>
        </form>
      </section>
    </section>

    <!-- Footer -->
    <footer class="footer mt-16 bg-[var(--camp-red)] text-white">
      <div
        class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10 grid gap-8 md:grid-cols-3"
      >
        <div>
          <h3 class="font-semibold text-lg text-white">
            Flag Frenzy Football Camp
          </h3>
          <p class="mt-2 text-white/80">Play fast. Play smart. Play flag.</p>
        </div>

        <div>
          <h4 class="font-semibold text-white">Quick Links</h4>
          <ul class="mt-2 space-y-2">
            <li>
              <a
                class="text-white hover:underline hover:text-yellow-400"
                href="/camp/policies.html"
                >Policies</a
              >
            </li>
            <li>
              <a
                class="text-white hover:underline hover:text-yellow-400"
                href="/camp/about.html"
                >About</a
              >
            </li>
            <li>
              <a
                class="text-white hover:underline hover:text-yellow-400"
                href="/camp/register.html"
                >Register</a
              >
            </li>
            <li>
              <a
                class="text-white hover:underline hover:text-yellow-400"
                href="/camp/contact.html"
                >Contact</a
              >
            </li>
            <li>
              <a
                class="text-white hover:underline hover:text-yellow-400"
                href="/index.html"
                >Main Site</a
              >
            </li>
          </ul>
        </div>

        <div>
          <h4 class="font-semibold text-white">Contact</h4>
          <ul class="mt-2 space-y-2">
            <li>
              <a
                class="text-white hover:underline hover:text-yellow-400"
                href="mailto:info@flagfrenzyfootball.co.uk"
                >info@flagfrenzyfootball.co.uk</a
              >
            </li>
            <li>
              <a
                class="text-white hover:underline hover:text-yellow-400"
                target="_blank"
                rel="noopener"
                href="https://instagram.com/flagfrenzycamp"
                >@flagfrenzycamp</a
              >
            </li>
          </ul>
        </div>
      </div>

      <!-- Bottom bar -->
      <div class="border-t border-white/20">
        <div
          class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 text-sm text-white/80 flex flex-col gap-2 md:flex-row md:items-center md:justify-between"
        >
          <div>
            <span
              >&copy; <span id="year"></span> Flag Frenzy Football Ltd. All
              rights reserved.</span
            >
            <div class="mt-2 text-xs leading-relaxed text-white/60">
              Flag Frenzy Football Ltd — Company No. 16566783<br
                class="sm:hidden"
              />
              <span class="hidden sm:inline">•</span> Registered in England
              &amp; Wales <span class="hidden sm:inline">•</span> Registered
              Office: 128 City Road, London, EC1V 2NX
            </div>
          </div>

          <span class="text-white/80">Built for the community.</span>
        </div>
      </div>
    </footer>

    <!-- Shared Camp JS -->
    <script src="/camp/js/main.js"></script>

    <!-- Save camper name for thank-you greeting -->
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const form = document.querySelector('form[name="camper-registration"]');
        if (form) {
          form.addEventListener("submit", function () {
            const camperNameField = document.querySelector(
              'input[name="camper-name"]'
            );
            if (camperNameField && camperNameField.value.trim() !== "") {
              localStorage.setItem("camperName", camperNameField.value.trim());
            }
          });
        }
      });
    </script>

    <!-- Show/hide day selector -->
    <script>
      const daySelector = document.getElementById("day-selector");
      const attendanceRadios = document.querySelectorAll(
        "input[name='attendance']"
      );
      attendanceRadios.forEach((r) => {
        r.addEventListener("change", () => {
          if (r.checked && r.value === "Choose Dates") {
            daySelector.classList.remove("hidden");
          } else if (r.checked && r.value === "Full Week") {
            daySelector.classList.add("hidden");
            document
              .querySelectorAll("input[name='selected-dates']:checked")
              .forEach((cb) => (cb.checked = false));
          }
        });
      });
    </script>

    <!-- Submit to Netlify, save for prefill, then redirect to pay.html -->
    <script>
      (function () {
        const form = document.getElementById("registerForm");
        if (!form) return;

        form.addEventListener("submit", async function (e) {
          e.preventDefault();

          // Attendance
          const attendance =
            document.querySelector("input[name='attendance']:checked")?.value ||
            "";

          // Sibling (normalize yes/no)
          const siblingRaw =
            document.querySelector("input[name='sibling']:checked")?.value ||
            "No";
          const sibling = siblingRaw.trim().toLowerCase().startsWith("y")
            ? "yes"
            : "no";

          // Build redirect URL
          let redirectUrl = "/camp/pay.html";
          let derivedPackage = "";
          let derivedDays = 0;

          if (attendance === "Full Week") {
            if (typeof isEarlyBird === "function" && isEarlyBird()) {
              redirectUrl += "?package=earlybird";
              derivedPackage = "earlybird";
            } else {
              redirectUrl += "?package=fullweek";
              derivedPackage = "fullweek";
            }
          } else if (attendance === "Choose Dates") {
            const selectedDates = Array.from(
              document.querySelectorAll("input[name='selected-dates']:checked")
            );
            const dayCount = selectedDates.length;
            if (dayCount === 0) {
              alert("Please select at least one day.");
              return;
            }
            redirectUrl += `?package=daypass&days=${dayCount}`;
            derivedPackage = "daypass";
            derivedDays = dayCount;
          } else {
            alert("Please select an attendance option.");
            return;
          }

          if (sibling === "yes") {
            redirectUrl += "&sibling=yes";
          }

          // Build form data for Netlify
          const fd = new FormData(form);
          fd.append("form-name", "camper-registration");
          fd.append("derived-package", derivedPackage);
          fd.append("derived-days", String(derivedDays));
          fd.append("derived-sibling", sibling);
          fd.append("submitted-at", new Date().toISOString());

          try {
            // Convert to URL-encoded string
            const body = new URLSearchParams(fd);

            // Submit to Netlify
            await fetch("/", {
              method: "POST",
              headers: { "Content-Type": "application/x-www-form-urlencoded" },
              body,
            });

            // Save for prefill
            const toStore = {};
            fd.forEach((v, k) => {
              if (toStore[k] === undefined) {
                toStore[k] = v;
              } else if (Array.isArray(toStore[k])) {
                toStore[k].push(v);
              } else {
                toStore[k] = [toStore[k], v];
              }
            });
            sessionStorage.setItem(
              "fffc-registration",
              JSON.stringify(toStore)
            );

            // Redirect only AFTER Netlify submission
            window.location.href = redirectUrl;
          } catch (err) {
            console.warn("Netlify submit failed:", err);
            alert(
              "Something went wrong submitting your form. Please try again."
            );
          }
        });
      })();
    </script>

    <!-- Prefill (supports multi-value checkboxes like selected-dates) -->
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const saved = sessionStorage.getItem("fffc-registration");
        if (!saved) return;

        try {
          const data = JSON.parse(saved);

          for (const [key, value] of Object.entries(data)) {
            const fields = document.querySelectorAll(`[name="${key}"]`);
            if (!fields.length) continue;

            if (fields.length > 1) {
              const values = Array.isArray(value) ? value : [value];
              fields.forEach((el) => {
                if (el.type === "checkbox" || el.type === "radio") {
                  el.checked = values.includes(el.value);
                }
              });
            } else {
              const field = fields[0];
              if (field.type === "checkbox" || field.type === "radio") {
                field.checked = field.value === value;
              } else {
                field.value = value;
              }
            }
          }
        } catch (err) {
          console.warn("Prefill failed:", err);
        }
      });
    </script>
  </body>
</html>
